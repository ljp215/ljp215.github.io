
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Zane Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Jinping Luo">
    
    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Zane Blog">
<meta property="og:url" content="http://luojinping.com/page/2/">
<meta property="og:site_name" content="Zane Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zane Blog">
<meta name="twitter:description">


    
    <link rel="alternative" href="/atom.xml" title="Zane Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a2d87d3add52ff134d9fac6cc16e4800";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Zane Blog" title="Zane Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Zane Blog">Zane Blog</a></h1>
				<h2 class="blog-motto">业精于勤荒于嬉，形成思毁于随</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:luojinping.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/22/使用-HBase-总结/" title="使用 HBase 总结" itemprop="url">使用 HBase 总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-05-22T08:27:28.000Z" itemprop="datePublished"> Published May 22 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="1-_HBase_简介">1. HBase 简介</h1>
<p>HBase是Apache Hadoop的数据库，基于列存储、构建在HDFS上的分布式存储系统，能够对大型数据提供随机、实时的读写访问，是Google的BigTable的开源实现。HBase的目标是存储并处理大型的数据，仅用普通的硬件配置，就能够处理海量数据。</p>
<h2 id="1-1_HBase_的优点">1.1 HBase 的优点</h2>
<ol>
<li>高可扩展性<br>HBase 是真正意义上的线性水平扩展。数据量累计到一定程度(可配置)，HBase系统会自动对数据进行水平切分，并分配不同的服务器来管理这些数据。这些数据可以被扩散到上千个普通服务器上。这样一方面可以由大量普通服务器组成大规模集群，来存放海量数据(从几个 TB 到几十 PB 的数据)。另一方面，当数据峰值接近系统设计容量时，可以简单通过增加服务器的方式来扩大容量。这个动态扩容过程无需停机，HBase系统可以照常运行并提供读写服务，完全实现动态无缝无宕机扩容。</li>
<li>高性能<br>HBase 的设计目的之一是支持高并发用户数的高速读写访问。这是通过两方面来实现的。首先数据行被水平切分并分布到多台服务器上，在大量用户访问时，访问请求也被分散到了不同的服务器上，虽然每个服务器的服务能力有限，但是数千台服务器汇总后可以提供极高性能的访问能力。其次，HBase 设计了高效的缓存机制，有效提高了访问的命中率，提高了访问性能。</li>
<li>高可用性<br>HBase 建立在 HDFS 之上。HDFS 提供了数据自动复制和容错的功能。HBase 的日志和数据都存放在 HDFS 上，即使在读写过程中当前服务器出现故障(硬盘、内存、网络等故障)，日志也不会丢失，数据都可以从日志中自动恢复。HBase 系统会自动分配其他服务器接管并恢复这些数据。因此一旦成功写入数据，这些数据就保证被持久化并被冗余复制，整个系统的高可用性得到保证。</li>
</ol>
<h2 id="1-2_数据模型">1.2 数据模型</h2>
<ol>
<li><p>表</p>
<ul>
<li>数据量：一张表可以有数十亿行，上百万列。</li>
<li>最大版本数：通常是3，如果对于更新比较频繁的应用完全可以设置为1，能够快速的淘汰无用数据，对于节省存储空间和提高查询速度有效果。不过这类需求在海量数据领域比较小众。</li>
<li>压缩算法：可以尝试一下最新出炉的snappy算法，相对lzo来说，压缩率接近，压缩效率稍高，解压效率高很多。</li>
<li>inmemory：表在内存中存放，一直会被忽略的属性。如果完全将数据存放在内存中，那么hbase和现在流行的内存数据库memorycached和redis性能差距有多少，尚待实测。</li>
<li>bloomfilter：根据应用来定，看需要精确到rowkey还是column。不过这里需要理解一下原理，bloomfilter的作用是对一个region下查找记录所在的hfile有用。即如果一个region下的hfile数量很多，bloomfilter的作用越明显。适合那种compaction赶不上flush速度的应用。</li>
</ul>
</li>
<li><p>无模式<br>每行都有一个可排序的主键和任意多的列，列可以根据需要动态的增加，同一张表中不同的行可以有截然不同的列；</p>
</li>
<li>面向列<br>面向列（族）的存储和权限控制，列（族）独立检索；</li>
<li>稀疏<br>对于空（null）的列，并不占用存储空间，表可以设计的非常稀疏；</li>
<li>数据多版本<br>每个单元中的数据可以有多个版本，默认情况下版本号自动分配，是单元格插入时的时间戳；</li>
<li>数据类型单一<br>HBase中的数据都是字符串，没有类型。</li>
<li>存储单元 Cell<br>由{rowkey, colomnFamily:colomnQualifier, version} 确定的唯一单元，存储的数据是byte[]类型的。</li>
</ol>
<h1 id="2-_HBase_的设计与实现">2. HBase 的设计与实现</h1>
<h2 id="2-1_HBase_的架构">2.1 HBase 的架构</h2>
<p><img src="/img/HBase_ architecture.jpg" alt=""><br>由上图可知，hbase包括Clinet、HMaster、HRegionServer、ZooKeeper组件<br>各组件功能介绍：</p>
<ol>
<li>Client<br>Client主要通过ZooKeeper与Hbaser和HRegionServer通信，对于管理操作：client向master发起请求，对于数据读写操作：client向regionserver发起请求</li>
<li>ZooKeeper<br>zk负责存储<em>root</em>表的地址，也负责存储当前服务的master地址,regsion server也会将自身的信息注册到zk中，以便master能够感知region server的状态，zk也会协调active master，也就是可以提供一个选举master leader,也会协调各个region server的容灾流程</li>
<li>HMaster<br>master可以启动多个master，master主要负责table和region的管理工作，响应用户对表的CRUD操作，管理region server的负载均衡，调整region 的分布和分配，当region server停机后，负责对失效的regionn进行迁移操作</li>
<li>HRegionServer<br>region server主要负责响应用户的IO请求，并把IO请求转换为读写HDFS的操作</li>
</ol>
<h2 id="2-2_HBase_的架构详解">2.2 HBase 的架构详解</h2>
<p><a href="https://www.mapr.com/blog/in-depth-look-hbase-architecture#.VdMxvWSqqko" target="_blank" rel="external">https://www.mapr.com/blog/in-depth-look-hbase-architecture#.VdMxvWSqqko</a></p>
<h1 id="3-_HBase,_Mysql_的比较">3. HBase, Mysql 的比较</h1>
<p>Mysql 是关系型数据库，对于数据量不大(百万级别)，强依赖事务的业务，使用Mysql。<br>HBase 适用于对大数据进行随机、实时访问的场合，支持海量数据，扩展性好。<br>HBase 不适用的场景：</p>
<ul>
<li>对分布式事务支持的不好</li>
<li>不支持多表的联合查询</li>
<li>对于复杂查询，需要扫描全表，且不支持索引</li>
</ul>
<h1 id="4-_设计_HBase_表">4. 设计 HBase 表</h1>
<h2 id="4-1_RowKey_的设计">4.1 RowKey 的设计</h2>
<p>Rowkey唯一原则，必须在设计上保证其唯一性。但是还有几点需要注意的地方：</p>
<h3 id="4-1-1_RowKey_长度的设计">4.1.1 RowKey 长度的设计</h3>
<p>Rowkey是一个二进制码流，可以是任意字符串，最大长度64KB，实际应用中一般为10~100bytes，存为byte[]字节数组。</p>
<ol>
<li>定长<br>定长的好处是 RowKey 排序时是按字典序且不受不同长度的影响</li>
<li>短<br>不要超过16个字节。<ul>
<li>数据的持久化文件 HFile 是按照 KeyValue 存储的，如果 Rowkey 过长比如100个字节，1000万列数据光 Rowkey 就要占用100*1000万=10亿个字节，将近1G数据，这会极大影响 HFile 的存储效率；</li>
<li>MemStore 将缓存部分数据到内存，如果 Rowkey 字段过长内存的有效利用率会降低，系统将无法缓存更多的数据，这会降低检索效率。</li>
</ul>
</li>
<li>16个字节<br>目前操作系统是都是64位系统，内存8字节对齐。控制在16个字节，8字节的整数倍利用操作系统的最佳特性。</li>
</ol>
<h3 id="4-1-2_RowKey_含义的设计">4.1.2 RowKey 含义的设计</h3>
<p>RowKey 虽然是越短越好，但也需要考虑 RowKey 的含义。由于 HBase 是按字典序存储，所以 RowKey 设计的合理可以提高查询效率(因为这会提高 RegionServer 的缓存命中率)，并且有意义的 RowKey 也便于在 scan 表的时候确定 startRow 和 stopRow。</p>
<ol>
<li>RowKey 包含时间<br>不要将时间放在二进制码的前面，建议将 RowKey 的高位作为散列字段（或者本身就已经是散列的其他id，例如userId），低位放时间字段。否则最新的数据都集中放在某个 RegionServer，而访问量又都集中在最新的数据上，将会导致 Hotspotting 现象，降低了访问速度，同时也增加了 RegionServer Crash 的概率。<br>但考虑到是按字典序存储，如果想让最新的数据在最前面，可以使用 Long.MAX_VALUE – timestamp 作为 RowKey 的一部分。</li>
<li>RowKey 包含多个含义时<br>各个含义用某种分隔符分开，比如包含用户，类型，时间三种含义的 RowKey, 可以设计为 userId#type#timestamp，这样如果需要查找某个用户某段时间的数据，scan 时只需要根据 userId 设置 startRow 和 stopRow 即可。</li>
</ol>
<h3 id="4-1-3_RowKey_性能的设计">4.1.3 RowKey 性能的设计</h3>
<p>RowKey 是按照字典序存储，利用这个排序特点，将经常一起读取或者最近可能被访问到的数据存储到一块可以提高查询效率。</p>
<ol>
<li>Hotspotting<br>It is always advisable not to use sequential row keys, even though you get better scan results. More info here.<br>Salting Row Key. To prevent hot spotting on writes, the row key may be “salted” by inserting a leading byte into the row key which is a mod over N buckets of the hash of the entire row key. This ensures even distribution of writes when the row key is a monotonically increasing value (often a timestamp representing the current time).</li>
<li>Length of row key<br>For each cell, rowkey details, column family, and qualifier details are stored. So it is always advisable to keep them as shot as possible, mainly because the same information is repeated on large scale.</li>
<li>So whats next<br>salt usage and its prefixing will help to distribute the rows among region servers.This can help you.</li>
</ol>
<h2 id="4-2_ColumnFamily_的设计">4.2 ColumnFamily 的设计</h2>
<h3 id="4-2-1_ColumnFamily_的长度">4.2.1 ColumnFamily 的长度</h3>
<p>The column family and column qualifier names are repeated for each row. Therefore, keep the names as short as possible to reduce the amount of data that HBase stores and reads. For example, use f:q instead of mycolumnfamily:mycolumnqualifier.</p>
<h3 id="4-2-2_ColumnFamily_的数量">4.2.2 ColumnFamily 的数量</h3>
<p>On the number of column families<br>HBase currently does not do well with anything above two or three column families so keep the number of column families in your schema low. Currently, flushing and compactions are done on a per Region basis so if one column family is carrying the bulk of the data bringing on flushes, the adjacent families will also be flushed though the amount of data they carry is small. When many column families the flushing and compaction interaction can make for a bunch of needless i/o loading (To be addressed by changing flushing and compaction to work on a per column family basis). For more information on compactions, see compaction. (具体的细节见第2节)</p>
<p>Try to make do with one column family if you can in your schemas. Only introduce a second and third column family in the case where data access is usually column scoped; i.e. you query one column family or the other but usually not both at the one time.</p>
<p>Where multiple ColumnFamilies exist in a single table, be aware of the cardinality (i.e., number of rows). If ColumnFamilyA has 1 million rows and ColumnFamilyB has 1 billion rows, ColumnFamilyA’s data will likely be spread across many, many regions (and RegionServers). This makes mass scans for ColumnFamilyA less efficient.</p>
<p>建议HBASE列族的数量设置的越少越好。由于HBASE的FLUSHING和压缩是基于REGION的当一个列族所存储的数据达到FLUSHING阀值时，该表的所有列族将同时进行FLASHING操作，这将带来不必要的I/O开销。同时还要考虑到同一个表中不同列族所存储的记录数量的差别，即列族的势。当列族数量差别过大将会使包含记录数量较少的列族的数据分散在多个Region之上，而Region可能是分布是不同的RegionServer上。这样当进行查询等操作系统的效率会受到一定影响。</p>
<h2 id="4-3_Column_的设计">4.3 Column 的设计</h2>
<h3 id="4-3-1_Column_的长度">4.3.1 Column 的长度</h3>
<p>The column family and column qualifier names are repeated for each row. Therefore, keep the names as short as possible to reduce the amount of data that HBase stores and reads. For example, use f:q instead of mycolumnfamily:mycolumnqualifier.</p>
<h3 id="4-3-2_Column_的数量">4.3.2 Column 的数量</h3>
<p>Column mapping: one to many<br>You can map a single HBase entity (row key or a column) to multiple SQL columns. This kind of mapping is called one to many. HBase stores a lot of information for each value. If you stored each SQL column individually, the required storage space would be very large. For the best performance, put columns that are queried together into a single dense HBase column to help reduce the data that is fetched from HBase. A dense column is a single HBase column that maps to multiple SQL columns.</p>
<p>For example, if table T1 has nine columns with 1.5 million rows. and you use a one-to-one mapping, this table requires 522 MB of storage. However, if table T1 uses a one-to-many mapping, the table requires only 276 MB of storage.</p>
<h1 id="5-_读_HBase_的性能">5. 读 HBase 的性能</h1>
<h2 id="5-1_HBase_Pool">5.1 HBase Pool</h2>
<p>Use pool of workers to parallel requests. You may find useful HTablePool class for managing connections in workers.</p>
<h2 id="5-2_批量读">5.2 批量读</h2>
<p>通过调用 HTable.get(Get) 方法可以根据一个指定的 RowKey 获取一行记录，同样 HBase 提供了另一个方法：通过调用 HTable.get(List<get>) 方法可以根据一个指定的 RowKey 列表，批量获取多行记录，这样做的好处是批量执行，只需要一次网络I/O开销，这对于对数据实时性要求高而且网络传输RTT高的情景下可能带来明显的性能提升。</get></p>
<h2 id="5-3_Scan">5.3 Scan</h2>
<ol>
<li>Scanner Caching<br>hbase.client.scanner.caching配置项可以设置HBase scanner一次从服务端抓取的数据条数，默认情况下一次一条。通过将其设置成一个合理的值，可以减少scan过程中next()的时间开销，代价是 scanner需要通过客户端的内存来维持这些被cache的行记录。</li>
<li>Scan AttributeSelection<br>scan时指定需要的Column Family，可以减少网络传输数据量，否则默认scan操作会返回整行所有Column Family的数据。</li>
<li>Close ResultScanner<br>通过scan取完数据后，记得要关闭ResultScanner，否则RegionServer可能会出现问题（对应的Server资源无法释放）。</li>
</ol>
<h2 id="5-4_PrefixFilter">5.4 PrefixFilter</h2>
<h3 id="5-4-1_PefixFilter_Vs_Scan">5.4.1 PefixFilter Vs Scan</h3>
<ul>
<li>HBase filters - even row filters - are really slow, since in most cases these do a complete table scan, and then filter on those results. </li>
<li>Row key range scans however, are indeed much faster - they do the equivalent of a filtered table scan. This is because the row keys are stored in sorted order (this is one of the basic guarantees of HBase, which is a BigTable-like solution), so the range scans on row keys are very fast.</li>
</ul>
<h3 id="5-4-2_Convert_PrefixFilter_to_Scan">5.4.2 Convert PrefixFilter to Scan</h3>
<p>PrefixFilter: abc<br>Scan ‘mytable’, {STARTROW =&gt; ‘abc’, ENDROW =&gt; ‘abd’}</p>
<h1 id="6-_如何解决事务">6. 如何解决事务</h1>
<ol>
<li>transactions over hbase<br>The way HBase works is that locks are held in the regionserver (not in the client) when the Puts are applied to make sure that rows are written in an atomic block but it does not provide snapshot isolation (you need to use something like omid if you want that).</li>
</ol>
<p>Since HBase does not guarantee any consistency between regions (and each region is hosted at exactly one RegionServer) all MVCC data structures only need to be kept in memory on every region server.</p>
<p>I would probably not use HBase for a use case like this. but if you must you can lock the row, read, update if needed - read more about lock and some of its problems here ngdata.com/hbase-row-locks . Again, I’d try to rethink the scenario for instance, HBase support multiple version so you can update anyway and sort things later (e.g. in a coprocessor that runs after update)<br>RowLock and associated operations are deprecated in 0.94 and removed in 0.96.issues.apache.org/jira/browse/HBASE-7315 – Matt Ball</p>
<ol>
<li>hbase checkAndPut<br>hbase checkandput performance<br>When you use checkAndPut() you do one RPC-call per request. So, you can’t achieve performance more then 1 / rtt requests per second (rtt is Round Trip Time). If you have rtt 1ms between your client and region server, your theoretical maximum is 1000 rps. When using batch operations like put(List<put>) you need a lot less RPC-calls causing performance increase.</put></li>
</ol>
<h1 id="Reference">Reference</h1>
<blockquote>
<p><a href="http://blog.linezing.com/2012/03/hbase-performance-optimization/" target="_blank" rel="external">http://blog.linezing.com/2012/03/hbase-performance-optimization/</a><br><a href="https://www.ibm.com/support/knowledgecenter/SSPT3X_2.1.2/com.ibm.swg.im.infosphere.biginsights.analyze.doc/doc/bigsql_designhints.html" target="_blank" rel="external">https://www.ibm.com/support/knowledgecenter/SSPT3X_2.1.2/com.ibm.swg.im.infosphere.biginsights.analyze.doc/doc/bigsql_designhints.html</a><br><a href="http://blog.kissdata.com/2014/07/30/hbase-scheme-tips.html" target="_blank" rel="external">http://blog.kissdata.com/2014/07/30/hbase-scheme-tips.html</a><br><a href="http://blog.chedushi.com/archives/9720" target="_blank" rel="external">http://blog.chedushi.com/archives/9720</a><br><a href="https://www.mapr.com/blog/in-depth-look-hbase-architecture#.VdMxvWSqqko" target="_blank" rel="external">https://www.mapr.com/blog/in-depth-look-hbase-architecture#.VdMxvWSqqko</a><br><a href="https://cloud.google.com/bigtable/docs/schema-design" target="_blank" rel="external">https://cloud.google.com/bigtable/docs/schema-design</a><br><a href="http://www.slideshare.net/alexbaranau/transactions-over-hbase" target="_blank" rel="external">http://www.slideshare.net/alexbaranau/transactions-over-hbase</a><br><a href="https://hbase.apache.org/acid-semantics.html" target="_blank" rel="external">https://hbase.apache.org/acid-semantics.html</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/分布式/">分布式</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/22/使用-HBase-总结/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/17/https详解/" title="https详解" itemprop="url">https详解</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-04-17T13:55:14.000Z" itemprop="datePublished"> Published Apr 17 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="什么是https">什么是https</h1>
<p>也称作HTTP over TLS</p>
<h1 id="什么是SSL/TLS">什么是SSL/TLS</h1>
<p>1994年，NetScape公司设计了SSL协议（Secure Sockets Layer）的1.0版，但是未发布。<br>1995年，NetScape公司发布SSL 2.0版，很快发现有严重漏洞。<br>1996年，SSL 3.0版问世，得到大规模应用。<br>1999年，互联网标准化组织ISOC接替NetScape公司，发布了SSL的升级版TLS 1.0版。<br>2006年和2008年，TLS进行了两次升级，分别为TLS 1.1版和TLS 1.2版。最新的变动是2011年TLS 1.2的修订版。<br>TLS 1.0通常被标示为SSL 3.1，TLS 1.1为SSL 3.2，TLS 1.2为SSL 3.3。</p>
<h1 id="为什么要有https">为什么要有https</h1>
<p>在说HTTPS之前先说说什么是HTTP，HTTP就是我们平时浏览网页时候使用的一种协议。HTTP协议传输的数据都是未加密的，也就是明文的，因此使用HTTP协议传输隐私信息非常不安全。为了保证这些隐私数据能加密传输，于是网景公司设计了SSL（Secure Sockets Layer）协议用于对HTTP协议传输的数据进行加密，从而就诞生了HTTPS。</p>
<h1 id="https保证安全的原理">https保证安全的原理</h1>
<p>Client端和Server端如果用非对称加密的算法进行通信肯定是绝对安全的，因为私钥和密钥没有第三方知道。但是这样的问题是性能低下。但是如果用对称加密，很容易泄露密钥，安全性得不到保证。那么https是如何做的呢？<br>大概原理就是使用非对称加密来交换一个密钥来进行对称加密。这个过程被称为SSL/TSL的四次握手，具体过程如下：</p>
<ol>
<li>Client端向Server端的443端口发出请求，带上随机数client_random和支持的加密方式列表</li>
<li>Server端返回随机数server_random ，选择的加密方式和服务器证书链</li>
<li>Client端验证这个证书是否合法，如果非法则提示用户是否“继续接受这个不可信的网站”，如果合法则使用证书中的公钥加密premaster secret发送给服务端</li>
<li>Server端使用私钥解密premaster secret，然后通过client_random，server_random 和premaster secret 生成master secret，用于对称加密后续通信内容。</li>
<li>Sever端用master secret加密最终需要返回的网站内容</li>
<li>Client端也用相同的方式生成这个master secret解密收到的消息</li>
</ol>
<p>master_secret = PRF(pre_master_secret, “master secret”, ClientHello.random + ServerHello.random)[0..47];</p>
<p><strong>随机数为什么要三个？</strong><br>这是由于SSL/TLS设计，就假设服务器不相信所有的客户端都能够提供完全随机数，假如某个客户端提供的随机数不随机的话，就大大增加了“对话密钥”被破解的风险，所以由三组随机数组成最后的随机数，保证了随机数的随机性，以此来保证每次生成的“对话密钥”安全性。</p>
<p><strong>那么问题来了</strong></p>
<ol>
<li>证书的安全性，Client端是如何验证证书合法性的，这个证书第三方无论如何都伪造不了吗？</li>
<li>对称加密密钥的安全性，生成的master secret密钥第三方为什么拿不到？</li>
</ol>
<p>要解答这两个问题，首先得弄清楚什么是证书。</p>
<h1 id="为什么证书是安全的？">为什么证书是安全的？</h1>
<h2 id="什么是证书">什么是证书</h2>
<p>数字证书就是互联网通讯中标志通讯各方身份信息的一串数字，提供了一种在Internet上验证通信实体身份的方式，数字证书不是数字身份证，而是身份认证机构盖在数字身份证上的一个章或印（或者说加在数字身份证上的一个签名）。它是由权威机构——<strong>CA机构，又称为证书授权（Certificate Authority）</strong>中心发行的，人们可以在网上用它来识别对方的身份。<br>数字证书的格式普遍采用的是X.509V3国际标准，一个标准的X.509数字证书包含以下一些内容：</p>
<ul>
<li>证书的版本信息；</li>
<li>证书的序列号，每个证书都有一个唯一的证书序列号；</li>
<li>证书所使用的签名算法；</li>
<li>证书的发行机构名称，命名规则一般采用X.500格式；</li>
<li>证书的有效期，通用的证书一般采用UTC时间格式，它的计时范围为1950-2049；</li>
<li>证书所有人的名称，命名规则一般采用X.500格式；</li>
<li>证书所有人的公开密钥；</li>
<li>证书发行者对证书的签名。</li>
</ul>
<p>证书里的公钥的作用？<br>证书里的签名的作用？<br>数字证书的签发机构CA，在接收到申请者的资料后进行核对并确定信息的真实有效，然后就会制作一份符合X.509标准的文件。证书中的证书内容包含的持有者信息和公钥等都是由申请者提供的，而数字签名则是CA机构对证书内容进行hash加密后得到的，而这个数字签名就是我们验证证书是否是有可信CA签发的数据。<br><img src="/img/CA.png" alt=""></p>
<h2 id="证书的产生">证书的产生</h2>
<p><img src="/img/certification_production.png" alt=""></p>
<h2 id="证书的类型">证书的类型</h2>
<p>实际上，我们使用的证书分很多种类型，SSL证书只是其中的一种。证书的格式是由X.509标准定义。SSL证书负责传输公钥，是一种PKI（Public Key Infrastructure，公钥基础结构）证书。<br>我们常见的证书根据用途不同大致有以下几种：<br>1、SSL证书，用于加密HTTP协议，也就是HTTPS。<br>2、代码签名证书，用于签名二进制文件，比如Windows内核驱动，Firefox插件，Java代码签名等等。<br>3、客户端证书，用于加密邮件。<br>4、双因素证书，网银专业版使用的USB Key里面用的就是这种类型的证书。<br>这些证书都是由受认证的证书颁发机构——我们称之为CA（Certificate Authority）机构来颁发，针对企业与个人的不同，可申请的证书的类型也不同，价格也不同。CA机构颁发的证书都是受信任的证书，对于SSL证书来说，如果访问的网站与证书绑定的网站一致就可以通过浏览器的验证而不会提示错误。</p>
<h2 id="证书的安全问题">证书的安全问题</h2>
<p><strong>如果让证书安全，那么就需要让客户端拿到的证书是真正想要的证书，即不能让证书被冒充或者被篡改。</strong><br>那么如何保证这一点呢？</p>
<ol>
<li>如果证书自己有一个id</li>
<li>证书的这个id无法被伪造</li>
<li>客户端知道自己想要的证书id是多少</li>
</ol>
<p>如果做到了这三点就能保证证书的安全性了。上面说提到的id就是证书的数字签名。那么什么是数字签名？</p>
<h3 id="数字签名（digital_signature）">数字签名（digital signature）</h3>
<p>数字签名是证书的防伪标签，是将待签名内容通过哈希和私钥加密处理后生成的。目前使用最广泛的 SHA-RSA 数字签名的制作和验证过程如下：</p>
<ol>
<li>数字签名的签发。首先是使用哈希函数对待签名内容进行安全哈希，生成数字摘要，然后使用CA自己的私钥对数字摘要进行加密。</li>
<li>数字签名的校验。使用CA的公钥解密签名，然后使用相同的签名函数对待签名证书内容进行签名并和服务端数字签名里的签名内容进行比较，如果相同就认为校验成功。</li>
</ol>
<p>签发：待签名内容 -&gt; 哈希 -&gt; 数字摘要 -&gt; CA私钥加密 -&gt; 数字签名<br>校验：</p>
<ul>
<li>数字签名 -&gt; CA公钥解密 -&gt; 数字摘要1</li>
<li>待签名内容 -&gt; 哈希 -&gt; 数字摘要2</li>
<li>比较「数字摘要1」和「数字摘要2」是否相等<br><img src="/img/CerValiate.png" alt=""></li>
</ul>
<p>这里有几点需要说明：</p>
<ul>
<li>数字签名签发和校验使用的密钥对是 CA 自己的公私密钥，跟证书申请者提交的公钥没有关系。</li>
<li>数字签名的签发过程跟公钥加密的过程刚好相反，即是用私钥加密，公钥解密。</li>
<li>现在大的 CA 都会有证书链，证书链的好处一是安全，保持根 CA 的私钥离线使用。第二个好处是方便部署和撤销，即如果证书出现问题，只需要撤销相应级别的证书，根证书依然安全。</li>
<li>根 CA 证书都是自签名，即用自己的公钥和私钥完成了签名的制作和验证。而证书链上的证书签名都是使用上一级证书的密钥对完成签名和验证的。</li>
</ul>
<p><strong>那么问题又来了。</strong><br>CA的私钥和公钥是安全的吗？可以被冒充吗？</p>
<h3 id="CA的安全性">CA的安全性</h3>
<p>从根CA开始到直接给客户发放证书的各层次CA，都有其自身的密钥对。CA中心的密钥对一般由硬件加密服务器在机器内直接产生，并存储于加密硬件内，或以一定的加密形式存放于密钥数据库内。加密备份于IC卡或其他存储介质中，并以高等级的物理安全措施保护起来。密钥的销毁要以安全的密钥冲写标准，彻底清除原有的密钥痕迹。需要强调的是，根CA密钥的安全性至关重要，它的泄露意味着整个公钥信任体系的崩溃，所以CA的密钥保护必须按照最高安全级 的保护方式来进行设置和管理。</p>
<p>CA的私钥是自己靠上述方法保管的，不对外公开。<br>CA的公钥是厂商跟浏览器和操作系统合作，把公钥默认装到浏览器或者操作系统环境里。比如firefox 就自己维护了一个可信任的 CA 列表，而chrome 和 IE 使用的是操作系统的 CA 列表。</p>
<h2 id="证书验证失败的原因">证书验证失败的原因</h2>
<p>1、SSL证书不是由受信任的CA机构颁发的(注意这种情况并不一定说明有SSL劫持发生)<br>2、证书过期<br>3、访问的网站域名与证书绑定的域名不一致</p>
<p>至此，可以知道证书在一定程度上是非常安全的，客户端只要收到的证书是合法的，就能很大程度上保证整个会话是安全的。</p>
<h1 id="客户端具体是如何验证SSL证书的">客户端具体是如何验证SSL证书的</h1>
<p>为了抵御这种中间人攻击，SSL证书需要由可信的SSL证书颁发机构颁发，形成一个证书链（比如Gmail的证书链为：最底层为网域 mail.google.com，上一层为Thawte SGC CA证书颁发机构，最顶层为很有名的VeriSign证书颁发机构）。那么，浏览器除了需要验证域和有效期外，还要检查证书链中的上级证书公钥是否有效，上级的上级证书公钥是否有效，直至根证书公钥为止。这样就可以有效避免中间人攻击了，因为根证书公钥都是预装在操作系统中的，黑客如果不是暴力破解，无法得到根证书的私钥。如果黑客自己生成一个私钥，浏览器验证根证书公钥的时候发现无法通过操作系统中预装的公钥加密数据后使用这个私钥进行解密，从而判定这个公钥是无效的。这个方案也是现在https通讯通常的方案。</p>
<p>那么，这个现在所有的浏览器正在使用的https通讯方案就无懈可击了吗？答案仍是否定的。我们可以看到，在后一个方案中，https的安全性需要在证书颁发机构公信力的强有力保障前提下才能发挥作用。如果证书颁发机构在没有验证黑客为mail.google.com的持游者的情况下，给黑客颁发了网域为mail.google.com的证书，那么黑客的中间人攻击又可以顺利实施然而，不验证域名持有者就颁发证书的情况在国外几乎不会发生，但是在国内就不一定了。针对破解目标，国内证书颁发机构WoSign（在此只是举例国内比较有名的证书颁发机构WoSign，并不代表WoSign今后一定会这么做）很有可能为了上级要求颁发了证书给非域名持有者的黑客，从而使得破解目标的Gmail密码被黑客截取。</p>
<h1 id="涉及到的算法">涉及到的算法</h1>
<p>非对称加密算法：RSA，DSA/DSS<br>对称加密算法：AES，RC4，3DES<br>HASH算法：MD5，SHA1，SHA256</p>
<h1 id="总结">总结</h1>
<p>整个过程是递进的，一步一步了解https安全的原理。</p>
<ol>
<li>https如何保证安全又高效？<br>https使用非对称加密算法来交换对称加密的密钥，最后使用对称加密算法来进行通信。</li>
<li>如何保证非对称加密时的安全性？<br>服务端发送证书来传递非对称加密的公钥。保证了公钥和私钥的保密性。</li>
<li>客户端怎么知道证书是不是真的？<br>客户端根据CA证书的公钥校验证书的数字签名来保证其合法性。</li>
<li>客户端的CA证书不会被伪造或泄露吗？<br>CA证书是默认预装到浏览器和操作系统中的，所以CA证书的公钥是安全的。</li>
</ol>
<h1 id="Reference">Reference</h1>
<blockquote>
<p><a href="http://op.baidu.com/2015/04/https-s01a01/" target="_blank" rel="external">http://op.baidu.com/2015/04/https-s01a01/</a><br><a href="https://cipherstuff.wordpress.com/" target="_blank" rel="external">https://cipherstuff.wordpress.com/</a><br><a href="http://oncenote.com/2014/10/21/Security-1-HTTPS/" target="_blank" rel="external">http://oncenote.com/2014/10/21/Security-1-HTTPS/</a><br><a href="http://www.williamlong.info/archives/2058.html" target="_blank" rel="external">http://www.williamlong.info/archives/2058.html</a><br><a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/网络/">网络</a><a href="/tags/安全/">安全</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/04/17/https详解/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/27/LeetCode-Perfect-Squares/" title="LeetCode - Perfect Squares" itemprop="url">LeetCode - Perfect Squares</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-03-27T02:41:50.000Z" itemprop="datePublished"> Published Mar 27 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Problem_Description：">Problem Description：</h2>
<p>Given a positive integer n, find the least number of perfect square numbers (for example, 1, 4, 9, 16, …) which sum to n.<br>For example, given n = 12, return 3 because 12 = 4 + 4 + 4; given n = 13, return 2 because 13 = 4 + 9.</p>
<h2 id="Solution:">Solution:</h2>
<h3 id="Solution1:">Solution1:</h3>
<p>Dynamic Programming<br>Time Complexity: O(n*sqrt(n))<br>Space: O(n)</p>
<h3 id="Solution2:">Solution2:</h3>
<p>Number Theory</p>
<ul>
<li>Legendre’s three-square theorem </li>
<li>Lagrange’s four-square theorem</li>
</ul>
<p>Time Complexity: O(sqrt(n))<br>Space: O(1)</p>
<h2 id="Code">Code</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zane.algorithm.leetcode;</div><div class="line"></div><div class="line"><span class="javadoc">/**</span></div><div class="line"> * Author: luojinping</div><div class="line"> * Date: 15/9/23</div><div class="line"> * Time: 17:23</div><div class="line"> * &lt;p/&gt;</div><div class="line"> * &lt;p/&gt;</div><div class="line"> * Given a positive integer n, find the least number of perfect square numbers</div><div class="line"> * (for example, 1, 4, 9, 16, ...) which sum to n.</div><div class="line"> * For example, given n = 12, return 3 because 12 = 4 + 4 + 4; given n = 13,</div><div class="line"> * return 2 because 13 = 4 + 9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PerfectSquares_279</span> </span>{</div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * cannot use greedy algorithm, counter example：</div><div class="line">     * 98=81+16+1=49+49</div><div class="line">     * 101=100+1=49+1+49+2</div><div class="line">     * 7=4+1+1+1</div><div class="line">     * 12=4+4+4=9+1+1+1</div><div class="line">     * 思路:</div><div class="line">     * 使用DP, dp[]数组记录历史使用最少平方数的情况.例如dp[5]=2,记录的是使用最少(1+4)平方数的数量,即2.</div><div class="line">     *</div><div class="line">     *<span class="javadoctag"> @param</span> n</div><div class="line">     *<span class="javadoctag"> @return</span></div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numSquares</span>(<span class="keyword">int</span> n) {</div><div class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) {</div><div class="line">            <span class="keyword">return</span> n;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// record the least number of perfect numbers when index = i</span></div><div class="line">        <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</div><div class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</div><div class="line">        dp[<span class="number">2</span>] = <span class="number">2</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; i++) {</div><div class="line">            <span class="keyword">int</span> leastNum = i;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j * j &lt;= i; j++) {</div><div class="line">                leastNum = Math.min(leastNum, dp[i - j * j] + <span class="number">1</span>);</div><div class="line"></div><div class="line">            }</div><div class="line">            dp[i] = leastNum;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> dp[n];</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSquare</span>(<span class="keyword">int</span> n) {</div><div class="line">        <span class="keyword">int</span> sqrt_n = (<span class="keyword">int</span>) (Math.sqrt(n));</div><div class="line">        <span class="keyword">return</span> (sqrt_n * sqrt_n == n);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="javadoc">/**</span></div><div class="line">     * Legendre's three-square theorem:</div><div class="line">     * The three squares theorem tells you that a positive integer n can be represented as the sum</div><div class="line">     * of 3 squares (n = x^2 + y^2 + z^2) if and only if it is not of the form n = 4^a * (8 * b+7)</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * Lagrange's four-square theorem:</div><div class="line">     * Every natural number can be represented as the sum of four integer squares:</div><div class="line">     * n= a^2 + b^2 + c^2 + d^2</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * So the are only 4 possible results: 1, 2, 3, 4.</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * Refer:</div><div class="line">     * https://leetcode.com/discuss/58056/summary-of-different-solutions-bfs-static-and-mathematics</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numSquaresByMath</span>(<span class="keyword">int</span> n) {</div><div class="line">        <span class="comment">// If n is a perfect square, return 1.</span></div><div class="line">        <span class="keyword">if</span> (isSquare(n)) {</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// The result is 4 if and only if n can be written in the</span></div><div class="line">        <span class="comment">// form of 4^k*(8*m + 7). Please refer to</span></div><div class="line">        <span class="comment">// Legendre's three-square theorem.</span></div><div class="line">        <span class="keyword">while</span> ((n & <span class="number">3</span>) == <span class="number">0</span>) <span class="comment">// n%4 == 0</span></div><div class="line">        {</div><div class="line">            n &gt;&gt;= <span class="number">2</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span> ((n & <span class="number">7</span>) == <span class="number">7</span>) <span class="comment">// n%8 == 7</span></div><div class="line">        {</div><div class="line">            <span class="keyword">return</span> <span class="number">4</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Check whether 2 is the result.</span></div><div class="line">        <span class="keyword">int</span> sqrt_n = (<span class="keyword">int</span>) (Math.sqrt(n));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sqrt_n; i++) {</div><div class="line">            <span class="keyword">if</span> (isSquare(n - i * i)) {</div><div class="line">                <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">        PerfectSquares_279 perfectSquares279 = <span class="keyword">new</span> PerfectSquares_279();</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">4</span>));</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">7</span>));</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">12</span>));</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">61</span>));</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">100</span>));</div><div class="line">        System.out.println(perfectSquares279.numSquares(<span class="number">101</span>));</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="Refer:">Refer:</h2>
<blockquote>
<p><a href="https://leetcode.com/discuss/58056/summary-of-different-solutions-bfs-static-and-mathematics" target="_blank" rel="external">https://leetcode.com/discuss/58056/summary-of-different-solutions-bfs-static-and-mathematics</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a><a href="/tags/LeetCode/">LeetCode</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/27/LeetCode-Perfect-Squares/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/26/LeetCode-The-Skyline-Problem/" title="LeetCode - The Skyline Problem" itemprop="url">LeetCode - The Skyline Problem</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-03-26T14:47:52.000Z" itemprop="datePublished"> Published Mar 26 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Problem_Description">Problem Description</h2>
<p>A city’s skyline is the outer contour of the silhouette formed by all the buildings in that city when viewed from a distance. Now suppose you are given the locations and height of all the buildings as shown on a cityscape photo (Figure A), write a program to output the skyline formed by these buildings collectively (Figure B).</p>
<p> Buildings  Skyline Contour<br>The geometric information of each building is represented by a triplet of integers [Li, Ri, Hi], where Li and Ri are the x coordinates of the left and right edge of the ith building, respectively, and Hi is its height. It is guaranteed that 0 ≤ Li, Ri ≤ INT_MAX, 0 &lt; Hi ≤ INT_MAX, and Ri - Li &gt; 0. You may assume all buildings are perfect rectangles grounded on an absolutely flat surface at height 0.</p>
<p>For instance, the dimensions of all buildings in Figure A are recorded as: [ [2 9 10], [3 7 15], [5 12 12], [15 20 10], [19 24 8] ] .</p>
<p>The output is a list of “key points” (red dots in Figure B) in the format of [ [x1,y1], [x2, y2], [x3, y3], … ] that uniquely defines a skyline. A key point is the left endpoint of a horizontal line segment. Note that the last key point, where the rightmost building ends, is merely used to mark the termination of the skyline, and always has zero height. Also, the ground in between any two adjacent buildings should be considered part of the skyline contour.</p>
<p>For instance, the skyline in Figure B should be represented as:[ [2 10], [3 15], [7 12], [12 0], [15 10], [20 8], [24, 0] ].</p>
<p>Notes:</p>
<ul>
<li>The number of buildings in any input list is guaranteed to be in the range [0, 10000].</li>
<li>The input list is already sorted in ascending order by the left x position Li.</li>
<li>The output list must be sorted by the x position.<br>There must be no consecutive horizontal lines of equal height in the output skyline. For instance, […[2 3], [4 5], [7 5], [11 5], [12 7]…] is not acceptable; the three lines of height 5 should be merged into one in the final output as such: […[2 3], [4 5], [12 7], …]</li>
</ul>
<p><strong>problem link:</strong><br><a href="https://leetcode.com/problems/the-skyline-problem/" target="_blank" rel="external">https://leetcode.com/problems/the-skyline-problem/</a></p>
<h2 id="Solution">Solution</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">public class <span class="type">TheSkylineProblem_218</span> {</div><div class="line">    public <span class="type">List</span>&lt;<span class="type">int</span>[]&gt; getSkylineSimpleSolution(<span class="type">int</span>[][] buildings) {</div><div class="line">        <span class="type">List</span>&lt;<span class="type">int</span>[]&gt; <span class="literal">result</span> = new <span class="type">ArrayList</span>&lt;&gt;();</div><div class="line">        <span class="type">List</span>&lt;<span class="type">int</span>[]&gt; height = new <span class="type">ArrayList</span>&lt;&gt;();</div><div class="line"></div><div class="line">        // height &lt; <span class="number">0</span>: the height <span class="keyword">of</span> building started</div><div class="line">        // height &gt; <span class="number">0</span>: the height <span class="keyword">of</span> building ended</div><div class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] b : buildings) {</div><div class="line">            height.add(new <span class="type">int</span>[]{b[<span class="number">0</span>], -b[<span class="number">2</span>]});</div><div class="line">            height.add(new <span class="type">int</span>[]{b[<span class="number">1</span>], b[<span class="number">2</span>]});</div><div class="line">        }</div><div class="line"></div><div class="line">        // sorted by x value, <span class="keyword">if</span> x equals then sorted by y value</div><div class="line">        <span class="type">Collections</span>.sort(height, (a, b) -&gt; {</div><div class="line">            <span class="keyword">if</span> (a[<span class="number">0</span>] != b[<span class="number">0</span>])</div><div class="line">                <span class="keyword">return</span> a[<span class="number">0</span>] - b[<span class="number">0</span>];</div><div class="line">            <span class="keyword">return</span> a[<span class="number">1</span>] - b[<span class="number">1</span>];</div><div class="line">        });</div><div class="line"></div><div class="line">        // record the height <span class="keyword">of</span> visited buildings by reverse order</div><div class="line">        <span class="type">Queue</span>&lt;<span class="type">Integer</span>&gt; pq = new <span class="type">PriorityQueue</span>&lt;&gt;((a, b) -&gt; (b - a));</div><div class="line">        pq.offer(<span class="number">0</span>);</div><div class="line"></div><div class="line">        <span class="type">int</span> prevHeight = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] h : height) {</div><div class="line">            <span class="keyword">if</span> (h[<span class="number">1</span>] &lt; <span class="number">0</span>) {</div><div class="line">                // save the height <span class="keyword">of</span> building</div><div class="line">                pq.offer(-h[<span class="number">1</span>]);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                // remove the height <span class="keyword">of</span> building</div><div class="line">                pq.remove(h[<span class="number">1</span>]);</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="type">int</span> curHeight = pq.peek();</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (prevHeight != curHeight) {</div><div class="line">                // find the turn point</div><div class="line">                <span class="literal">result</span>.add(new <span class="type">int</span>[]{h[<span class="number">0</span>], curHeight});</div><div class="line">                prevHeight = curHeight;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="literal">result</span>;</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="算法解释">算法解释</h2>
<h3 id="算法思路">算法思路</h3>
<ol>
<li>遍历所有的点，height用来存放每个顶点，左顶点的高度转为负数，右顶点的高度仍然是正数</li>
<li>对height数组排序，首先按x的值排序，当x的值相等时按z排序，这样保证了即使矩形的起点一样，也是最先处理最高的点。对于[{1,2,1},{1,2,2},{1,2,3}]这样的情况会优先处理{1,2,3}这个点。</li>
<li>使用优先级队列pq来保存当前最近buildings的高度，这个结构很重要！</li>
<li>遍历height数组，碰到左顶点时，将高度放入pq中，否则，碰到右顶点时则将高度从pq从移除。这样做的好处是，每次走完一个矩形时，高度能回归到之前的buildings的高度。</li>
<li>获取当前的最高高度，因为如果比当前矮的话，是不需要放入拐点中的，这点很重要！</li>
<li>如果当前的最高高度和之前的高度不一致，说明出现了拐点。**如果当前的最高高度矮于之前的值，说明之前的很高的建筑遇到了它的右顶点从而被移除了，所以目前的最高高度即使矮于之前的点，但是是新的隔离的building了，所以可以加入。那么如果高呢？当前高度比之前高，那肯定会是拐点了。</li>
</ol>
<h2 id="总结">总结</h2>
<p>几个关键点：</p>
<ol>
<li>对顶点进行排序保存，对左右顶点根据正负号来加以区分</li>
<li>使用一个优先级队列来保存目前最高的建筑</li>
<li>碰到右顶点时消除目前的建筑高度</li>
<li>根据之前的高度和处理目前顶点以后(可能是加入了高度也可能是消除了之前的高度)的高度，对两者进行比较来找到拐点</li>
</ol>
<h2 id="Reference">Reference</h2>
<blockquote>
<p><a href="https://leetcode.com/discuss/54201/short-java-solution" target="_blank" rel="external">https://leetcode.com/discuss/54201/short-java-solution</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a><a href="/tags/LeetCode/">LeetCode</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/26/LeetCode-The-Skyline-Problem/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/03/扔鸡蛋测楼层/" title="扔鸡蛋测楼层" itemprop="url">扔鸡蛋测楼层</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-03-03T12:26:36.000Z" itemprop="datePublished"> Published Mar 3 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="扔瓶子测楼层">扔瓶子测楼层</h2>
<p>一栋楼有n层，需要测试某种材质的玻璃瓶从哪一层掉下来恰好会碎。现在仅有两个这样的瓶子。请问怎样仍才能最快的测出楼层的临界值？</p>
<h2 id="A-_只用一个瓶子从第一层扔到第n层">A. 只用一个瓶子从第一层扔到第n层</h2>
<p>找到临界值的扔瓶子次数的期望为每一层的期望次数之和</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">E(x) = <span class="number">1</span>/n * <span class="number">1</span> + <span class="number">1</span>/n * <span class="number">2</span> + <span class="number">1</span>/n * <span class="number">3</span> + <span class="keyword">...</span> + <span class="number">1</span>/n * n = (<span class="number">1</span>+n)/<span class="number">2</span></div></pre></td></tr></table></figure>


<p>所以时间复杂度是O(n)</p>
<h2 id="B-_用贪心的思维">B. 用贪心的思维</h2>
<p>第一个瓶子从第1层开始扔，每次层数翻倍，依次为，1，2，4，8，16，直至在第 2^k 层碎掉。<br>第二个瓶子从第 2^(k-1) 层开始扔，直至第 2^k 层为止，中间肯定能找到临界值。<br>所以时间复杂度是O(lgn)</p>
<h2 id="C-_用二分法">C. 用二分法</h2>
<p>第一个瓶子每次以(i, j)为区间，扔的位置为(i+j)/2, 初始情况, i=0,j=n, 如果瓶子没碎，则i=j，直至碎掉。<br>第二个瓶子从第 i 层开始扔，直至第 j 层为止，中间肯定能找到临界值。</p>
<p>对于第 i 层，扔的情况为：</p>
<ul>
<li>第一个瓶子：n/2, $/2+n/4 i, n/2+n/4+n/8</li>
<li>第二个瓶子：n/2+n/4, (n/2+n/k+1), …, i</li>
</ul>
<p>显而易见，时间复杂度是O(n)</p>
<h2 id="D-_数学推算">D. 数学推算</h2>
<p>这个题目是需要最快的找出临界值，可以转换为，即使在最坏的情况下，也能最快地找出临界值。</p>
<p>我们先假设最坏情况下，瓶子下落次数为x，即我们为了找出N，一共用瓶子做了x次的实验。 </p>
<p>那么，我们第一次应该在哪层楼往下扔瓶子呢？</p>
<p>先让我们假设第一次是在第y层楼扔的瓶子，如果第一个瓶子在第一次扔就碎了，我们就只剩下一个瓶子，要用它准确地找出N，只能从第一层向上，一层一层的往上测试，直到它摔坏为止，答案就出来了。</p>
<p>由于第一个瓶子在第y层就摔破了，所以最坏的情况是第二个瓶子要把第1到第y-1层的楼都测试一遍，最后得出结果，噢，原来瓶子在第y-1层才能摔破(或是在第y-1层仍没摔破，答案就是第y层。) 这样一来测试次数是1+(y-1)=x，即第一次测试要在第x层。</p>
<p>OK，那如果第一次测试鸡蛋没摔破呢，那N肯定要比x大，要继续往上找，需要在哪一层扔呢？我们可以模仿前面的操作，如果第一个瓶子在第二次测试中摔破了，那么第二个瓶子的测试次数就只剩下x-2次了(第一个瓶子已经用了2次)。这样一来，第二次扔瓶子的楼层和第一次扔瓶子的楼层之间就隔着x-2层。 </p>
<p>我们再回过头来看一看，第一次扔瓶子的楼层在第x层，第1层到第x层间共x层；第1次扔鸡蛋的楼层到第2次扔瓶子的楼层间共有x-1层(包含第2次扔瓶子的那一层)，同理继续往下，我们可以得出，第2次扔瓶子的楼层到第3次扔瓶子的楼层间共有x-2层，最后把这些互不包含的区间数加起来，应该大于等于总共的楼层数量100，即</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x + (x-<span class="number">1</span>) + (x-<span class="number">2</span>) + <span class="keyword">...</span> + <span class="number">1</span> &gt;= <span class="number">100</span></div><div class="line">(x+<span class="number">1</span>)*x/<span class="number">2</span> &gt;= <span class="number">100</span></div><div class="line">得出答案是<span class="number">14</span></div></pre></td></tr></table></figure>

<p>即我先用第1个瓶子在以下序列表示的楼层数不断地向上测试，直到它摔破。 再用第2个瓶子从上一个没摔破的序列数的下一层开始，向上测试，即可保证在最坏情况下也只需要测试14次，就能用2个瓶子找出从哪一层开始，往下扔鸡蛋，瓶子就会摔破。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">14, 27, 39, 50, 60, 69, 77, 84, 90, 95, 99, 100</div></pre></td></tr></table></figure>

<h2 id="E-_DP的解法">E. DP的解法</h2>
<p>假设f(n)表示从第n层楼扔下鸡蛋，没有摔碎的最少尝试次数。第一个鸡蛋，可能的落下位置[1,n],第一个鸡蛋从第i层扔下，有两种情况：</p>
<ul>
<li>碎了，第二个鸡蛋，需要从第一层开始试验，有i-1次机会</li>
<li>没碎，两个鸡蛋，还有n-i层。这个就是子问题了f(n-i)</li>
</ul>
<p>所以，当第一个鸡蛋，由第i个位置落下的时候，要尝试的次数为 1 + max{i - 1, f(n - i)}，那么对于每一个i，尝试次数最少的，就是f(n)的值。<br>状态转移方程如下： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">f</span><span class="params">(n)</span> = <span class="title">min</span>{1 + <span class="title">max</span>{<span class="title">i</span> - 1, <span class="title">f</span><span class="params">(n - <span class="number">1</span>)</span>}}</span></div></pre></td></tr></table></figure>

<p>其中: i的范围为[1, n], f(1) = 1.</p>
<h2 id="F-_推广到一般化的问题">F. 推广到一般化的问题</h2>
<p>为n层楼，m个鸡蛋。<br>如下分析： 假设f(n,m)表示n层楼、m个鸡蛋时找到最高楼层的最少尝试次数。当第一个鸡蛋从第i层扔下，有两种情况：</p>
<ul>
<li>碎了，还剩m-1个鸡蛋，为确定下面楼层中的安全楼层，还需要f(i-1,m-1)次，找到子问题</li>
<li>不碎，上面还有n-i层，还需要f(n-i,m)次，又一个子问题。</li>
</ul>
<p>状态转移方程如下： </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">f</span><span class="params">(n, m)</span> = <span class="title">min</span>{1 + <span class="title">max</span>{<span class="title">f</span><span class="params">(n - <span class="number">1</span>, m - <span class="number">1</span>)</span>, <span class="title">f</span><span class="params">(n - i, m)</span>}}</span></div></pre></td></tr></table></figure>

<p>其中： i为[1, n], f(i, 1) = 1</p>
<h2 id="Reference">Reference</h2>
<blockquote>
<p><a href="http://www.cricode.com/3558.html" target="_blank" rel="external">http://www.cricode.com/3558.html</a><br><a href="https://gist.github.com/sing1ee/5971946" target="_blank" rel="external">https://gist.github.com/sing1ee/5971946</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/03/扔鸡蛋测楼层/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/27/快排算法/" title="快排算法" itemprop="url">快排算法</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-02-27T02:52:46.000Z" itemprop="datePublished"> Published Feb 27 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="快速排序的思路">快速排序的思路</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">algorithm quicksort(<span class="literal">A</span>, lo, hi) is</div><div class="line">    <span class="keyword">if</span> lo &lt; hi then</div><div class="line">        p := partition(<span class="literal">A</span>, lo, hi)</div><div class="line">        quicksort(<span class="literal">A</span>, lo, p – <span class="number">1</span>)</div><div class="line">        quicksort(<span class="literal">A</span>, p + <span class="number">1</span>, hi)</div></pre></td></tr></table></figure>

<h2 id="快速排序的partition方式">快速排序的partition方式</h2>
<p>一种是Lomuto partition scheme，另外一种是Hoare partition scheme。</p>
<h2 id="Lomuto_partition">Lomuto partition</h2>
<p>This scheme is attributed to Nico Lomuto and popularized by Bentley in his book</p>
<h3 id="lomuto的partition实现方式">lomuto的partition实现方式</h3>
<p>i指示最前面的大于pivot的元素位置，j从前往后滑动来调整元素位置。每次j碰到小于pivot的元素，则swap i位置的元素和j位置的元素，再i指向下一个大于pivot的元素。<br>最后，记得swap i位置的元素和最末尾的元素。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">lomutoPartition</span>(<span class="keyword">int</span> nums[], <span class="keyword">int</span> lo, <span class="keyword">int</span> hi) {</div><div class="line">        <span class="keyword">int</span> pivot = nums[hi];</div><div class="line">        <span class="keyword">int</span> i = lo;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = lo; j &lt; hi; j++) {</div><div class="line">            <span class="keyword">if</span> (nums[j] &lt;= pivot) {</div><div class="line">                swap(nums, i, j);</div><div class="line">                i++;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        swap(nums, i, hi); <span class="comment">// replace the guard element</span></div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    }</div></pre></td></tr></table></figure>

<h2 id="Hoare_partition_scheme">Hoare partition scheme</h2>
<p>The original partition scheme described by C.A.R. Hoare uses two indices that start at the ends of the array being partitioned, then move toward each other, until they detect an inversion.</p>
<p><strong>Hoare’s scheme is more efficient than Lomuto’s partition scheme because it does three times fewer swaps on average, and it creates efficient partitions even when all values are equal.</strong></p>
<h3 id="hoare的partition实现方式">hoare的partition实现方式</h3>
<p>i从前往后找到大于pivot的元素，j从后往前找到小于pivot的元素，然后两者swap.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hoarePartition</span>(<span class="keyword">int</span> nums[], <span class="keyword">int</span> lo, <span class="keyword">int</span> hi) {</div><div class="line">        <span class="keyword">int</span> pivot = nums[lo];</div><div class="line">        <span class="keyword">int</span> i = lo, j = hi;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</div><div class="line">            <span class="keyword">while</span> (nums[i] &lt; pivot) {</div><div class="line">                i++;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keyword">while</span> (nums[j] &gt;= pivot) {</div><div class="line">                j--;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (i &gt;= j) {</div><div class="line">                <span class="keyword">return</span> j;</div><div class="line">            }</div><div class="line"></div><div class="line">            swap(nums, i, j);</div><div class="line">        }</div><div class="line">    }</div></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/27/快排算法/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/20/硬币找零问题/" title="硬币找零问题" itemprop="url">硬币找零问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-02-20T06:55:47.000Z" itemprop="datePublished"> Published Feb 20 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="硬币找零问题(Coin_Change)">硬币找零问题(Coin Change)</h1>
<h2 id="Question">Question</h2>
<p>You are given coins of different denominations and a total amount of money amount. Write a function to compute the fewest number of coins that you need to make up that amount. If that amount of money cannot be made up by any combination of the coins, return -1.</p>
<p>Example 1:<br>coins = [1, 2, 5], amount = 11<br>return 3 (11 = 5 + 5 + 1)</p>
<p>Example 2:<br>coins = [2], amount = 3<br>return -1.</p>
<p>Note:<br>You may assume that you have an infinite number of each kind of coin.</p>
<h2 id="DP求解">DP求解</h2>
<p>如果是用DP求解，那么思路首先就是找到子问题。子问题很容易确定，那就是amount-x是子问题的amount。比较容易想到的代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">coinChange</span>(<span class="keyword">int</span>[] coins, <span class="keyword">int</span> amount) {</div><div class="line">        <span class="keyword">if</span> (amount == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> n = amount + <span class="number">1</span>; <span class="comment">// the answer must smaller than [amount+1], nice!</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> coin : coins) {</div><div class="line">            <span class="keyword">int</span> curr = <span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span> (amount &gt;= coin) {</div><div class="line">                <span class="keyword">int</span> next = coinChange(coins, amount - coin);</div><div class="line">                <span class="keyword">if</span> (next &gt;= <span class="number">0</span>)</div><div class="line">                    curr = <span class="number">1</span> + next;</div><div class="line">            }</div><div class="line">            <span class="keyword">if</span> (curr &gt; <span class="number">0</span>)</div><div class="line">                n = Math.min(n, curr);</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> (n == amount + <span class="number">1</span>) ? -<span class="number">1</span> : n;</div><div class="line">    }</div></pre></td></tr></table></figure>

<p>上述算法的时间复杂度为O(c^n),c是coin的数量，n是amount的值。</p>
<p>时间复杂度较大的原因是，中间存在很多重复计算。那么需要用到DP的备忘录，不用全局变量来保存计算过的值，也不用递归的方法来实现，而是只用一个一维数组，再用循环来实现。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">coinChange</span>(<span class="keyword">int</span>[] coins, <span class="keyword">int</span> amount) {</div><div class="line">        <span class="keyword">if</span> (coins == <span class="keyword">null</span> || coins.length == <span class="number">0</span> || amount &lt;= <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span>[] minNumber = <span class="keyword">new</span> <span class="keyword">int</span>[amount + <span class="number">1</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= amount; i++) {</div><div class="line">            minNumber[i] = amount + <span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; coins.length; j++) {</div><div class="line">                <span class="keyword">if</span> (coins[j] &lt;= i && minNumber[i - coins[j]] != amount + <span class="number">1</span>)</div><div class="line">                    minNumber[i] = Integer.min(minNumber[i], <span class="number">1</span> + minNumber[i - coins[j]]);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">if</span> (minNumber[amount] == amount + <span class="number">1</span>)</div><div class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> minNumber[amount];</div><div class="line">    }</div></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/20/硬币找零问题/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/02/判断图是否为树/" title="判断图是否为树" itemprop="url">判断图是否为树</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-02-02T11:43:46.000Z" itemprop="datePublished"> Published Feb 2 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="题目">题目</h2>
<p>输入二维数组，a[i][j]=1 表示从i结点指向j结点。</p>
<h3 id="eg1">eg1</h3>
<p>0 1 1 0</p>
<p>1 0 0 1</p>
<p>1 0 0 0</p>
<p>0 1 0 0</p>
<p>是一棵树，树为：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">       a</div><div class="line">       </div><div class="line">      /  \</div><div class="line">      </div><div class="line">    b    <span class="built_in">c</span></div><div class="line">    </div><div class="line">  /</div><div class="line">  </div><div class="line">d</div></pre></td></tr></table></figure>

<h3 id="eg2">eg2</h3>
<p>0 1 1 0</p>
<p>1 0 0 1</p>
<p>1 0 1 0</p>
<p>0 1 1 0</p>
<p>不是一颗树，是有环(a-b-d-c-a)的图：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">       a</div><div class="line">       </div><div class="line">      /  \</div><div class="line">      </div><div class="line">    b    <span class="built_in">c</span></div><div class="line">    </div><div class="line">  /      /</div><div class="line">  </div><div class="line">d  - — -</div></pre></td></tr></table></figure>

<h2 id="关键点">关键点</h2>
<p>判断一张图是否是一颗树的两个关键点：</p>
<ul>
<li>不存在环路(对于有向图，不存在环路也就意味着不存在强连通子图)</li>
<li>满足边数加一等于顶点数的规律(不考虑重边和指向自身的边)</li>
</ul>
<h2 id="方法">方法</h2>
<ol>
<li><p>DFS</p>
</li>
<li><p>如果存在回路，则必存在一个子图，是一个环路。环路中所有顶点的度&gt;=2。时间复杂度O(ve)，v是顶点数，e是边数。</p><p>第一步：删除所有度&lt;=1的顶点及相关的边，并将另外与这些边相关的其它顶点的度减一。</p><p> 第二步：将度数变为1的顶点排入队列，并从该队列中取出一个顶点重复步骤一。如果最后还有未删除顶点，则存在环，否则没有环。这个复杂度也很高</p>
</li>
<li><p>结合树的特性(边数+1 = 顶点数)和并查集来做，代码见下文。</p>
</li>
</ol>
<h2 id="实现">实现</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div></pre></td><td class="code"><pre><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> TreeJudgeUnionB {</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> Edge {</div><div class="line">        <span class="keyword">int</span> start;</div><div class="line">        <span class="keyword">int</span> end;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="title">Edge</span>(<span class="keyword">int</span> start, <span class="keyword">int</span> end) {</div><div class="line">            <span class="keyword">this</span>.start = start;</div><div class="line">            <span class="keyword">this</span>.end = end;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// the number of edges</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</div><div class="line"></div><div class="line">    <span class="comment">// edge list</span></div><div class="line">    <span class="keyword">private</span> List&lt;Edge&gt; edges = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="comment">// the index of group</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] <span class="keyword">group</span>;</div><div class="line"></div><div class="line">    <span class="comment">// the size of tree</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] size;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="title">TreeJudgeUnionB</span>(<span class="keyword">int</span> n, List&lt;Edge&gt; edges) {</div><div class="line">        <span class="keyword">this</span>.n = n;</div><div class="line">        <span class="keyword">this</span>.edges = edges;</div><div class="line"></div><div class="line">        <span class="keyword">group</span> = <span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">        size = <span class="keyword">new</span> <span class="keyword">int</span>[n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) {</div><div class="line">            <span class="keyword">group</span>[i] = i;</div><div class="line">            size[i] = <span class="number">1</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span>(<span class="keyword">int</span> i) {</div><div class="line">        <span class="comment">// find the root of a tree which contains i node</span></div><div class="line">        <span class="keyword">while</span> (i != <span class="keyword">group</span>[i]) {</div><div class="line">            i = <span class="keyword">group</span>[i];</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> boolean <span class="title">union</span>(<span class="keyword">int</span> groupI, <span class="keyword">int</span> groupJ) {</div><div class="line">        <span class="keyword">int</span> iRoot = find(groupI);</div><div class="line">        <span class="keyword">int</span> jRoot = find(groupJ);</div><div class="line">        <span class="keyword">if</span> (iRoot != jRoot) {</div><div class="line">            <span class="keyword">if</span> (size[iRoot] &lt; size[jRoot]) {</div><div class="line">                <span class="keyword">group</span>[iRoot] = jRoot;</div><div class="line">                size[jRoot] += size[iRoot];</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                <span class="keyword">group</span>[jRoot] = iRoot;</div><div class="line">                size[iRoot] += size[jRoot];</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> boolean <span class="title">isTree</span>() {</div><div class="line">        <span class="keyword">for</span> (Edge edge : edges) {</div><div class="line">            <span class="keyword">if</span> (!union(edge.start, edge.end)) {</div><div class="line">                System.<span class="keyword">out</span>.println(<span class="string">"input two nodes in the same tree"</span>);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        boolean hasRoot = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">group</span>.length; i++) {</div><div class="line">            <span class="keyword">if</span> (i == <span class="keyword">group</span>[i]) {</div><div class="line">                <span class="keyword">if</span> (!hasRoot) {</div><div class="line">                    hasRoot = <span class="keyword">true</span>;</div><div class="line">                } <span class="keyword">else</span> {</div><div class="line">                    System.<span class="keyword">out</span>.println(<span class="string">"exist more than one tree root"</span>);</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        printGroup();</div><div class="line"></div><div class="line">        <span class="keyword">return</span> hasRoot;</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printGroup</span>() {</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) {</div><div class="line">            System.<span class="keyword">out</span>.print(<span class="keyword">group</span>[i] + <span class="string">", "</span>);</div><div class="line">        }</div><div class="line">        System.<span class="keyword">out</span>.println();</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">        <span class="keyword">int</span> n = <span class="number">5</span>;</div><div class="line">        List&lt;Edge&gt; edges = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">2</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">4</span>);</div><div class="line">        isTree(n, edges); <span class="comment">// true</span></div><div class="line"></div><div class="line">        n = <span class="number">5</span>;</div><div class="line">        edges.clear();</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        addEdge(edges, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">2</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">4</span>);</div><div class="line">        isTree(n, edges); <span class="comment">// false</span></div><div class="line"></div><div class="line">        n = <span class="number">4</span>;</div><div class="line">        edges.clear();</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line">        isTree(n, edges);  <span class="comment">// false</span></div><div class="line"></div><div class="line">        n = <span class="number">7</span>;</div><div class="line">        edges.clear();</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        addEdge(edges, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">        addEdge(edges, <span class="number">4</span>, <span class="number">5</span>);</div><div class="line">        addEdge(edges, <span class="number">3</span>, <span class="number">4</span>);</div><div class="line">        addEdge(edges, <span class="number">2</span>, <span class="number">3</span>);</div><div class="line">        addEdge(edges, <span class="number">0</span>, <span class="number">6</span>);</div><div class="line">        isTree(n, edges);  <span class="comment">// true</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addEdge</span>(List&lt;Edge&gt; edges, <span class="keyword">int</span> i, <span class="keyword">int</span> j) {</div><div class="line">        edges.add(<span class="keyword">new</span> Edge(i, j));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">isTree</span>(<span class="keyword">int</span> n, List&lt;Edge&gt; edges) {</div><div class="line">        TreeJudgeUnionB treeJudgeUnionA = <span class="keyword">new</span> TreeJudgeUnionB(n, edges);</div><div class="line"></div><div class="line">        boolean isTree = treeJudgeUnionA.isTree();</div><div class="line"></div><div class="line">        System.<span class="keyword">out</span>.println(<span class="string">"This is a tree? "</span> + isTree);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/02/判断图是否为树/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/02/并查集-Union-Find-算法/" title="并查集(Union-Find)算法" itemprop="url">并查集(Union-Find)算法</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-02-02T09:52:22.000Z" itemprop="datePublished"> Published Feb 2 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="介绍">介绍</h2>
<p>在计算机科学中，并查集是一种树型的数据结构，其保持着用于处理一些不相交集合（Disjoint Sets）的合并及查询问题。有一个联合-查找算法（union-find algorithm）定义了两个操作用于此数据结构：</p>
<p>Find：确定元素属于哪一个子集。它可以被用来确定两个元素是否属于同一子集。</p>
<p>Union：将两个子集合并成同一个集合。</p>
<h2 id="适用场景">适用场景</h2>
<p>适合于判断，给出一组结点，判断他们是否联通。</p>
<h2 id="实现思路">实现思路</h2>
<ol>
<li>建立n个分组，每个分组代表一堆可以互相联通的结点。</li>
<li>遍历每对结点，找到他们各自所属的分组A, B</li>
<li>如果A != B，则将A, B分组union起来，表示A, B分组联通了</li>
<li>如果A == B，则跳过</li>
</ol>
<h3 id="Simple_Find_操作">Simple Find 操作</h3>
<p>用 group[] 数组来判断某个id属于的组。初始状态时，每个id都属于不同的组。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(int <span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="built_in">size</span>; <span class="built_in">i</span>++)  </div><div class="line">    group<span class="matrix">[i]</span> = <span class="built_in">i</span>;</div></pre></td></tr></table></figure>

<h3 id="Simple_Union_操作">Simple Union 操作</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">union</span>(<span class="keyword">int</span> p, <span class="keyword">int</span> q) {   </div><div class="line">  <span class="comment">// get the groupId of every node</span></div><div class="line">  <span class="keyword">int</span> pId = find(p);  </div><div class="line">  <span class="keyword">int</span> qId = find(q);  </div><div class="line">  </div><div class="line">  <span class="comment">// the two nodes are connected, return</span></div><div class="line">  <span class="keyword">if</span> (pId == qId) {</div><div class="line">    <span class="keyword">return</span>;  </div><div class="line">  }</div><div class="line">  </div><div class="line">  <span class="comment">// union the two nodes, change groupId</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) {</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">group</span>[i] == pId) {</div><div class="line">        <span class="keyword">group</span>[i] = qId;  </div><div class="line">      }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="优化">优化</h3>
<p>上面最后一步的union操作存在性能问题，即每次都需要改变其中一个分组中的所有结点的分组id。优化的做法是，用一颗树来表示每个分组，树的根节点表示当前组的id。</p>
<p>但如果用树来表示会引入一个问题，即可能存在树退化为链表的情况，这样一来，每一次加入一个结点再找根结点也会很耗时，没有达到优化的目的。<br>针对树可能退化为链表的解决方案是，每次合并树时，总是将矮的树挂到高的树下。这种方式也称为「按秩合并」</p>
<p>除了使用树来优化union性能以外，还有一种方式，称为「路径压缩」，即 Find 递归地经过树，改变每一个节点的引用到根节点。得到的树将更加扁平，为以后直接或者间接引用节点的操作加速。</p>
<p>总结：</p>
<ol>
<li>使用树来存储分组，Union时「按秩合并」</li>
<li>「路径压缩」，Find时改变每一个节点的引用到根节点</li>
</ol>
<h3 id="Find_操作">Find 操作</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// store every tree's size</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)  </div><div class="line">    <span class="keyword">size</span>[i] = <span class="number">1</span>;</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span>(<span class="keyword">int</span> p)  </div><div class="line">{    </div><div class="line">  <span class="keyword">if</span>(p != <span class="keyword">group</span>[p]){</div><div class="line">    <span class="keyword">group</span>[p] = find(<span class="keyword">group</span>[p])</div><div class="line">  }</div><div class="line">    </div><div class="line">  <span class="keyword">return</span> <span class="keyword">group</span>[p]</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="Union_操作">Union 操作</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> union(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</div><div class="line">{</div><div class="line">	<span class="keyword">int</span> i = <span class="keyword">find</span>(p);</div><div class="line">	<span class="keyword">int</span> j = <span class="keyword">find</span>(q);</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (i == j) {</div><div class="line">	  <span class="keyword">return</span>;</div><div class="line">	} </div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">size</span>[i] &lt; <span class="keyword">size</span>[j]) { </div><div class="line">	  <span class="keyword">group</span>[i] = j; </div><div class="line">	  <span class="keyword">size</span>[j] += <span class="keyword">size</span>[i]; </div><div class="line">	}	<span class="keyword">else</span> { </div><div class="line">	  <span class="keyword">group</span>[j] = i; </div><div class="line">	  <span class="keyword">size</span>[i] += <span class="keyword">size</span>[j]; </div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="时间复杂度">时间复杂度</h3>
<p>Statement: If m operations, either Union or Find, are applied to n elements, the total run time is O(m log<em>n), where log</em> is the iterated logarithm.<br>Proof of O(log<em>n) time complexity of union-find: <a href="https://en.wikipedia.org/wiki/Proof_of_O\(log" target="_blank" rel="external">https://en.wikipedia.org/wiki/Proof_of_O\(log</a></em>n)_time_complexity_of_union%E2%80%93find</p>
<h2 id="Refer">Refer</h2>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/%E5%B9%B6%E6%9F%A5%E9%9B%86" target="_blank" rel="external">https://zh.wikipedia.org/wiki/%E5%B9%B6%E6%9F%A5%E9%9B%86</a><br><a href="http://blog.csdn.net/dm_vincent/article/details/7655764" target="_blank" rel="external">http://blog.csdn.net/dm_vincent/article/details/7655764</a><br><a href="https://en.wikipedia.org/wiki/Proof_of_O(log*n)_time_complexity_of_union%E2%80%93find" target="_blank" rel="external">https://en.wikipedia.org/wiki/Proof_of_O(log*n)_time_complexity_of_union%E2%80%93find</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/02/02/并查集-Union-Find-算法/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/22/初学Spark/" title="初学Spark" itemprop="url">初学Spark</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://luojinping.com/about" title="Jinping Luo" target="_blank" itemprop="author">Jinping Luo</a>
		
  <p class="article-time">
    <time datetime="2016-01-22T03:41:20.000Z" itemprop="datePublished"> Published Jan 22 2016</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="避免使用_GroupByKey">避免使用 GroupByKey</h1>
<p>当调用 groupByKey 时，所有的键值对(key-value pair) 都会被移动。在网络上传输这些数据非常没有必要。</p>
<p>以下函数应该优先于 groupByKey :</p>
<ul>
<li><p>combineByKey<br>组合数据，但是组合之后的数据类型与输入时值的类型不一样。</p>
</li>
<li><p>foldByKey<br>合并每一个 key 的所有值，在级联函数和“零值”中使用。</p>
</li>
</ul>
<h1 id="combineByKey">combineByKey</h1>
<h2 id="combineByKey的定义">combineByKey的定义</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">combineByKey</span>[<span class="title">C</span>]<span class="params">(</span></span></div><div class="line">  createCombiner: V =&gt; C,</div><div class="line">  mergeValue: <span class="params">(C, V)</span> =&gt; C, </div><div class="line">  mergeCombiners: <span class="params">(C, C)</span> =&gt; C, </div><div class="line">  partitioner: Partitioner, </div><div class="line">  mapSideCombine: Boolean = true, </div><div class="line">  serializer: Serializer = null): RDD[(K, C)] = {</div><div class="line">  // do something</div><div class="line">}</div></pre></td></tr></table></figure>

<p>combineByKey函数主要接受了三个函数作为参数，分别为createCombiner、mergeValue、mergeCombiners。这三个函数足以说明它究竟做了什么。理解了这三个函数，就可以很好地理解combineByKey。</p>
<h3 id="createCombiner">createCombiner</h3>
<p>createCombiner：在遍历RDD的过程中，对于遍历到的(k,v)，如果是第一次遇到，则对这个(k,v)调用createCombiner函数，它的作用是将v转换为c(类型是C，即聚合对象的类型，c作为聚合对象的初始值)</p>
<h3 id="mergeValue">mergeValue</h3>
<p>mergeValue：在遍历RDD的过程中，对于遍历到的(k,v)，如果不是第一次(而是第i次, 1 &lt; i &lt;= n)遇到，那么将对这个(k,v)调用mergeValue函数，它的作用是将v累加到聚合对象（类型C）中，mergeValue的类型是(C,V)=&gt;C,参数中的C遍历到此处的聚合对象，然后对v进行聚合得到新的聚合对象值</p>
<h3 id="mergeCombiners">mergeCombiners</h3>
<p>mergeCombiners：<strong>因为combineByKey是在分布式环境下执行，RDD的每个分区单独进行combineByKey操作，最后需要对各个分区的结果进行最后的聚合</strong>。它的函数类型是(C,C)=&gt;C，每个参数是分区聚合得到的聚合对象。</p>
<h3 id="combineByKey的流程">combineByKey的流程</h3>
<ul>
<li>假设一组具有相同 K 的 <k, v=""> records 正在一个个流向 combineByKey()，createCombiner 将第一个 record 的value 初始化为 c （比如，c = value），然后从第二个 record 开始，来一个 record 就使用 mergeValue(c,</k,></li>
<li>record.value) 来更新 c，比如想要对这些 records 的所有 values 做 sum，那么使用 c = c + record.value。等到records 全部被 mergeValue()，得到结果 c。假设还有一组 records（key 与前面那组的 key 均相同）一个个到来，</li>
<li>combineByKey() 使用前面的方法不断计算得到 c’。现在如果要求这两组 records 总的 combineByKey() 后的结果，那么可以使用 final c = mergeCombiners(c, c’) 来计算。</li>
</ul>
<h2 id="Example">Example</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> rdd1 = sc.makeRDD(<span class="type">Array</span>((<span class="string">"A"</span>,<span class="number">1</span>),(<span class="string">"A"</span>,<span class="number">2</span>),(<span class="string">"A"</span>,<span class="number">3</span>),(<span class="string">"B"</span>,<span class="number">1</span>),(<span class="string">"B"</span>,<span class="number">2</span>),(<span class="string">"C"</span>,<span class="number">3</span>)))</div><div class="line"></div><div class="line">// <span class="literal">result</span>: ((A,<span class="number">1_</span>$<span class="number">2_</span>@<span class="number">3</span>), (B,<span class="number">1_</span>$<span class="number">2_</span>), (C,<span class="number">3_</span>))</div><div class="line">rdd1.combineByKey(</div><div class="line">  (v : <span class="type">Int</span>) =&gt; v + <span class="string">"_"</span>,</div><div class="line">  (c : <span class="type">String</span>, v : <span class="type">Int</span>) =&gt; c + <span class="string">"@"</span> + v,</div><div class="line">  (c1 : <span class="type">String</span>, c2 : <span class="type">String</span>) =&gt; c1 + <span class="string">"$"</span> + c2 ).collect</div></pre></td></tr></table></figure>

<h2 id="combineByKey应用举例">combineByKey应用举例</h2>
<h3 id="求均值">求均值</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">val rdd = sc.textFile(<span class="string">"气象数据"</span>)</div><div class="line">val rdd2 = rdd.map(x=&gt;x.split(<span class="string">" "</span>)).map(x<span class="function"> =&gt;</span> (x(<span class="number">0</span>).substring(<span class="string">"从年月日中提取年月"</span>),x(<span class="number">1</span>).toInt))</div><div class="line">val <span class="function"><span class="title">createCombiner</span> = <span class="params">(k: String, v: Int)</span>=&gt;</span> {</div><div class="line">  (v,<span class="number">1</span>)</div><div class="line">}</div><div class="line">val <span class="function"><span class="title">mergeValue</span> = <span class="params">(c:(Int, Int), v:Int)</span> =&gt;</span> {</div><div class="line">  (c._1 + v, c._2 + <span class="number">1</span>)</div><div class="line">}</div><div class="line"></div><div class="line">val <span class="function"><span class="title">mergeCombiners</span> = <span class="params">(c1:(Int,Int),c2:(Int,Int))</span>=&gt;</span>{</div><div class="line">  (c1._1 + c2._1, c1._2 + c2._2)</div><div class="line">}</div><div class="line"></div><div class="line">val vdd3 = vdd2.combineByKey(</div><div class="line">  createCombiner,</div><div class="line">  mergeValue,</div><div class="line">  mergeCombiners</div><div class="line">)</div><div class="line"></div><div class="line">rdd3.foreach(x=&gt;println(x._1 + <span class="string">": average tempreture is "</span> + x._2._1/x._2._2)</div></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/spark/">spark</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/22/初学Spark/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/java/" title="java">java<sup>15</sup></a></li>
		
			<li><a href="/tags/算法/" title="算法">算法<sup>8</sup></a></li>
		
			<li><a href="/tags/多线程/" title="多线程">多线程<sup>6</sup></a></li>
		
			<li><a href="/tags/机器学习/" title="机器学习">机器学习<sup>5</sup></a></li>
		
			<li><a href="/tags/分布式/" title="分布式">分布式<sup>3</sup></a></li>
		
			<li><a href="/tags/调试/" title="调试">调试<sup>3</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>2</sup></a></li>
		
			<li><a href="/tags/LeetCode/" title="LeetCode">LeetCode<sup>2</sup></a></li>
		
			<li><a href="/tags/网络/" title="网络">网络<sup>2</sup></a></li>
		
			<li><a href="/tags/test/" title="test">test<sup>1</sup></a></li>
		
			<li><a href="/tags/shell/" title="shell">shell<sup>1</sup></a></li>
		
			<li><a href="/tags/skill/" title="skill">skill<sup>1</sup></a></li>
		
			<li><a href="/tags/安全/" title="安全">安全<sup>1</sup></a></li>
		
			<li><a href="/tags/spark/" title="spark">spark<sup>1</sup></a></li>
		
			<li><a href="/tags/并发/" title="并发">并发<sup>1</sup></a></li>
		
			<li><a href="/tags/Spark/" title="Spark">Spark<sup>1</sup></a></li>
		
			<li><a href="/tags/promote/" title="promote">promote<sup>1</sup></a></li>
		
			<li><a href="/tags/数据挖掘/" title="数据挖掘">数据挖掘<sup>1</sup></a></li>
		
			<li><a href="/tags/总结/" title="总结">总结<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m ljp215 Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Pacman">Jacman</a> © 2017 
		
		<a href="http://luojinping.com/about" target="_blank" title="Jinping Luo">Jinping Luo</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'zane215';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fnull' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- MathJax End -->

  </body>
 </html>
